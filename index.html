<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolCalc - Scientific Calculator with SOL Tools</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f0f4f8, #e0f7fa); /* Cool white/light blue gradient */
            font-family: 'Arial', sans-serif;
            color: #333; /* Dark text for light background */
        }

        .calculator {
            background: #ffffff; /* White calculator background */
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.2);
            width: 320px; /* Slightly wider for more buttons */
            backdrop-filter: blur(5px);
        }

        .display {
            background: #f0f4f8;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: right;
            font-size: 2em;
            color: #1a2a6c;
            border: 2px solid #76a7ff;
            overflow: hidden;
            white-space: nowrap;
        }

        .buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 columns for scientific buttons */
            gap: 10px;
        }

        button {
            padding: 15px;
            background: linear-gradient(135deg, #1f6feb, #00c3ff);
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(31, 111, 235, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(31, 111, 235, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        button.operator {
            background: linear-gradient(135deg, #ff6b1f, #ff00c3);
        }

        button.sci {
            background: linear-gradient(135deg, #2196f3, #673ab7);
        }

        button.equals {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            grid-column: span 2;
        }

        button.clear {
            background: linear-gradient(135deg, #f44336, #e57373);
            grid-column: span 2;
        }

        h1 {
            text-align: center;
            color: #1a2a6c;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-shadow: 0 0 10px rgba(118, 167, 255, 0.3);
        }

        .tool-section {
            margin-top: 30px;
            padding: 15px;
            background: #f0f4f8;
            border-radius: 10px;
            border: 1px solid #76a7ff;
        }

        .tool-section label {
            display: block;
            margin-bottom: 10px;
            font-size: 1em;
            color: #1a2a6c;
        }

        .tool-section input {
            width: 100%;
            padding: 10px;
            background: #ffffff;
            border: 1px solid #76a7ff;
            color: #333;
            border-radius: 5px;
            font-size: 1em;
            margin-bottom: 10px;
        }

        .tool-section button {
            width: 100%;
            margin-top: 10px;
        }

        .tool-section .result {
            margin-top: 15px;
            text-align: center;
            font-size: 1.2em;
            color: #4caf50;
        }

        .tool-section .loading {
            text-align: center;
            color: #1f6feb;
            font-style: italic;
            display: none;
        }

        .tool-section .error {
            color: #f44336;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>SOLCALC SCIENTIFIC</h1>
        <div class="display" id="display">0</div>
        <div class="buttons">
            <button class="clear" onclick="clearDisplay()">C</button>
            <button class="sci" onclick="appendToDisplay('Math.sqrt(')">√</button>
            <button class="sci" onclick="appendToDisplay('Math.pow(')">x^y</button>
            <button class="sci" onclick="appendToDisplay('Math.log(')">log</button>
            <button class="sci" onclick="appendToDisplay('Math.PI')">π</button>

            <button onclick="appendToDisplay('7')">7</button>
            <button onclick="appendToDisplay('8')">8</button>
            <button onclick="appendToDisplay('9')">9</button>
            <button class="operator" onclick="appendToDisplay('/')">/</button>
            <button class="sci" onclick="appendToDisplay('Math.sin(')">sin</button>

            <button onclick="appendToDisplay('4')">4</button>
            <button onclick="appendToDisplay('5')">5</button>
            <button onclick="appendToDisplay('6')">6</button>
            <button class="operator" onclick="appendToDisplay('*')">*</button>
            <button class="sci" onclick="appendToDisplay('Math.cos(')">cos</button>

            <button onclick="appendToDisplay('1')">1</button>
            <button onclick="appendToDisplay('2')">2</button>
            <button onclick="appendToDisplay('3')">3</button>
            <button class="operator" onclick="appendToDisplay('-')">-</button>
            <button class="sci" onclick="appendToDisplay('Math.tan(')">tan</button>

            <button onclick="appendToDisplay('0')">0</button>
            <button onclick="appendToDisplay('.')">.</button>
            <button class="operator" onclick="appendToDisplay('+')">+</button>
            <button class="sci" onclick="appendToDisplay('Math.exp(')">exp</button>
            <button onclick="appendToDisplay('(')">(</button>

            <button onclick="appendToDisplay(')')">)</button>
            <button class="equals" onclick="calculate()">=</button>
        </div>

        <div class="tool-section" id="converterSection">
            <label>Solana Price Converter</label>
            <input type="number" id="solAmount" placeholder="Enter amount in SOL" step="0.01">
            <button onclick="convertSolToUsd()">Convert SOL to USD</button>
            <div class="loading" id="converterLoading">Fetching price...</div>
            <div class="result" id="converterResult"></div>
        </div>

        <div class="tool-section" id="balanceSection">
            <label>Solana Wallet Balance Checker</label>
            <input type="text" id="walletAddress" placeholder="Enter Solana wallet address">
            <button onclick="checkWalletBalance()">Check SOL Balance</button>
            <div class="loading" id="balanceLoading">Fetching balance...</div>
            <div class="result" id="balanceResult"></div>
        </div>

        <div class="tool-section" id="tokenBalanceSection">
            <label>SPL Token Balance Checker</label>
            <input type="text" id="tokenWalletAddress" placeholder="Enter Solana wallet address">
            <input type="text" id="tokenMint" placeholder="Enter token mint address">
            <button onclick="checkTokenBalance()">Check Token Balance</button>
            <div class="loading" id="tokenLoading">Fetching token balance...</div>
            <div class="result" id="tokenResult"></div>
        </div>
    </div>

    <script>
        // Calculator Logic
        let display = document.getElementById('display');
        let currentInput = '0';

        function appendToDisplay(value) {
            if (currentInput === '0' && value !== '.' && !value.endsWith('(')) {
                currentInput = value;
            } else {
                currentInput += value;
            }
            display.textContent = currentInput;
        }

        function clearDisplay() {
            currentInput = '0';
            display.textContent = currentInput;
        }

        function calculate() {
            try {
                // Replace Math functions for eval
                let evalInput = currentInput
                    .replace(/Math.sqrt/g, 'Math.sqrt')
                    .replace(/Math.pow/g, 'Math.pow')
                    .replace(/Math.log/g, 'Math.log')
                    .replace(/Math.sin/g, 'Math.sin')
                    .replace(/Math.cos/g, 'Math.cos')
                    .replace(/Math.tan/g, 'Math.tan')
                    .replace(/Math.exp/g, 'Math.exp')
                    .replace(/Math.PI/g, 'Math.PI');

                currentInput = eval(evalInput).toString();
                display.textContent = currentInput;
            } catch (error) {
                display.textContent = 'Error';
                currentInput = '0';
            }
        }

        // Shared SOL Price Fetch
        async function fetchSolPrice() {
            const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd');
            if (!response.ok) {
                throw new Error('API request failed');
            }
            const data = await response.json();
            return data.solana.usd;
        }

        const RPC_URL = 'https://solana-mainnet.publicnode.com'; // More reliable public RPC

        // Shared RPC Fetch Function
        async function solanaRpc(method, params) {
            const response = await fetch(RPC_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    jsonrpc: "2.0",
                    id: 1,
                    method,
                    params
                })
            });
            if (!response.ok) {
                throw new Error('Solana RPC request failed');
            }
            const data = await response.json();
            if (data.error) {
                throw new Error(data.error.message || 'RPC error');
            }
            return data.result;
        }

        // Solana Converter Logic
        const solAmountInput = document.getElementById('solAmount');
        const converterLoading = document.getElementById('converterLoading');
        const converterResult = document.getElementById('converterResult');

        async function convertSolToUsd() {
            const amount = parseFloat(solAmountInput.value);
            if (isNaN(amount) || amount <= 0) {
                converterResult.textContent = 'Please enter a valid SOL amount.';
                converterResult.classList.add('error');
                return;
            }

            converterLoading.style.display = 'block';
            converterResult.textContent = '';
            converterResult.classList.remove('error');

            try {
                const price = await fetchSolPrice();
                const usdAmount = (amount * price).toFixed(2);
                converterResult.textContent = `${amount} SOL ≈ $${usdAmount} USD (Price: $${price.toFixed(2)})`;
            } catch (error) {
                converterResult.textContent = 'Error fetching SOL price. Try again later.';
                converterResult.classList.add('error');
            } finally {
                converterLoading.style.display = 'none';
            }
        }

        // Solana Wallet Balance Checker Logic
        const walletAddressInput = document.getElementById('walletAddress');
        const balanceLoading = document.getElementById('balanceLoading');
        const balanceResult = document.getElementById('balanceResult');

        async function checkWalletBalance() {
            const address = walletAddressInput.value.trim();
            if (!address) {
                balanceResult.textContent = 'Please enter a Solana wallet address.';
                balanceResult.classList.add('error');
                return;
            }

            balanceLoading.style.display = 'block';
            balanceResult.textContent = '';
            balanceResult.classList.remove('error');

            try {
                const balanceData = await solanaRpc("getBalance", [address]);
                const solBalance = (balanceData.value / 1e9).toFixed(4);

                const price = await fetchSolPrice();
                const usdBalance = (solBalance * price).toFixed(2);

                balanceResult.textContent = `Balance: ${solBalance} SOL ≈ $${usdBalance} USD (Price: $${price.toFixed(2)})`;
            } catch (error) {
                balanceResult.textContent = `Error: ${error.message}. Check the address and try again. If persistent, the public RPC may be rate-limited—consider a personal RPC key.`;
                balanceResult.classList.add('error');
            } finally {
                balanceLoading.style.display = 'none';
            }
        }

        // SPL Token Balance Checker Logic
        const tokenWalletAddressInput = document.getElementById('tokenWalletAddress');
        const tokenMintInput = document.getElementById('tokenMint');
        const tokenLoading = document.getElementById('tokenLoading');
        const tokenResult = document.getElementById('tokenResult');

        async function checkTokenBalance() {
            const address = tokenWalletAddressInput.value.trim();
            const mint = tokenMintInput.value.trim();
            if (!address || !mint) {
                tokenResult.textContent = 'Please enter both wallet address and token mint.';
                tokenResult.classList.add('error');
                return;
            }

            tokenLoading.style.display = 'block';
            tokenResult.textContent = '';
            tokenResult.classList.remove('error');

            try {
                // Get token accounts for the wallet
                const tokenAccounts = await solanaRpc("getTokenAccountsByOwner", [
                    address,
                    { mint },
                    { encoding: "jsonParsed" }
                ]);

                if (tokenAccounts.value.length === 0) {
                    tokenResult.textContent = 'No balance found for this token.';
                    return;
                }

                // Assume first account (usually ATA)
                const accountInfo = tokenAccounts.value[0].account.data.parsed.info;
                const rawBalance = accountInfo.tokenAmount.amount;
                const decimals = accountInfo.tokenAmount.decimals;
                const tokenBalance = (rawBalance / Math.pow(10, decimals)).toFixed(4);

                // Fetch token price from CoinGecko
                let price = 0;
                try {
                    const priceResponse = await fetch(`https://api.coingecko.com/api/v3/simple/token_price/solana?contract_addresses=${mint}&vs_currencies=usd`);
                    if (priceResponse.ok) {
                        const priceData = await priceResponse.json();
                        price = priceData[mint.toLowerCase()]?.usd || 0;
                    }
                } catch (priceError) {
                    console.warn('Token price fetch failed:', priceError);
                }

                const usdBalance = (tokenBalance * price).toFixed(2);

                tokenResult.textContent = `Balance: ${tokenBalance} Tokens ≈ $${usdBalance} USD (Price: $${price.toFixed(4)})`;
            } catch (error) {
                tokenResult.textContent = `Error: ${error.message}. Check inputs and try again. If persistent, the public RPC may be rate-limited—consider a personal RPC key.`;
                tokenResult.classList.add('error');
            } finally {
                tokenLoading.style.display = 'none';
            }
        }
    </script>
</body>
</html>
