<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Meme Generator</title>

<style>
    body {
        margin: 0;
        background: #0d1b3d;
        font-family: Arial, sans-serif;
        color: #fff;
        display: flex;
        justify-content: center;
        padding: 20px;
    }

    .container {
        background: #16254d;
        padding: 25px;
        border-radius: 12px;
        width: 100%;
        max-width: 900px;
        box-shadow: 0 0 25px rgba(0, 0, 0, 0.4);
    }

    h1 {
        text-align: center;
        margin-bottom: 25px;
        font-size: 32px;
        color: #77aaff;
    }

    .tools {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 20px;
    }

    .tools div {
        flex: 1;
        min-width: 150px;
    }

    input, select {
        width: 100%;
        padding: 10px;
        background: #0f1a38;
        border: 1px solid #2e3d66;
        color: #fff;
        border-radius: 8px;
    }

    #canvas-wrapper {
        position: relative;
        width: 100%;
        background: #0b132b;
        border: 2px solid #2e3d66;
        border-radius: 10px;
        margin-top: 20px;
        overflow: hidden;
        display: flex;
        justify-content: center;
    }

    canvas {
        max-width: 100%;
    }

    .text-box {
        position: absolute;
        cursor: move;
        font-weight: bold;
        text-transform: uppercase;
        text-align: center;
        pointer-events: auto;
        user-select: none;
    }

    button {
        width: 100%;
        padding: 12px;
        background: #1f6feb;
        color: white;
        margin-top: 15px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
    }

    button:hover {
        opacity: 0.85;
    }
</style>
</head>

<body>
<div class="container">
    <h1>Meme Generator</h1>

    <div class="tools">
        <div>
            <label>Upload Image</label>
            <input type="file" id="upload" accept="image/*">
        </div>

        <div>
            <label>Font</label>
            <select id="font">
                <option>Impact</option>
                <option>Arial</option>
                <option>Comic Sans MS</option>
                <option>Anton</option>
            </select>
        </div>

        <div>
            <label>Text Color</label>
            <input type="color" id="color" value="#ffffff">
        </div>

        <div>
            <label>Stroke Color</label>
            <input type="color" id="stroke" value="#000000">
        </div>
    </div>

    <label>Add Top Text</label>
    <input type="text" id="topText" placeholder="Top text">

    <label style="margin-top:10px;">Add Bottom Text</label>
    <input type="text" id="bottomText" placeholder="Bottom text">

    <div id="canvas-wrapper">
        <canvas id="memeCanvas"></canvas>

        <div id="topBox" class="text-box" style="top:10px;">TOP TEXT</div>
        <div id="bottomBox" class="text-box" style="bottom:10px;">BOTTOM TEXT</div>
    </div>

    <button id="download">Download Meme</button>
</div>

<script>
const upload = document.getElementById("upload");
const canvas = document.getElementById("memeCanvas");
const ctx = canvas.getContext("2d");

const topBox = document.getElementById("topBox");
const bottomBox = document.getElementById("bottomBox");

let img = new Image();

// drag logic
function makeDraggable(el) {
    let isDown = false, offsetX, offsetY;

    el.addEventListener("mousedown", e => {
        isDown = true;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
    });

    window.addEventListener("mouseup", () => isDown = false);

    window.addEventListener("mousemove", e => {
        if (!isDown) return;
        el.style.left = (e.pageX - canvas.offsetLeft - offsetX) + "px";
        el.style.top = (e.pageY - canvas.offsetTop - offsetY) + "px";
    });
}

makeDraggable(topBox);
makeDraggable(bottomBox);

// update text live
document.getElementById("topText").addEventListener("input", e => {
    topBox.textContent = e.target.value.toUpperCase();
});
document.getElementById("bottomText").addEventListener("input", e => {
    bottomBox.textContent = e.target.value.toUpperCase();
});

// load image
upload.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        img.src = reader.result;
    };
    reader.readAsDataURL(file);
};

// draw final canvas
function renderMeme() {
    canvas.width = img.width;
    canvas.height = img.height;

    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    drawText(topBox);
    drawText(bottomBox);
}

function drawText(box) {
    const font = document.getElementById("font").value;
    const color = document.getElementById("color").value;
    const stroke = document.getElementById("stroke").value;

    const fontSize = canvas.width / 10;
    ctx.font = `${fontSize}px ${font}`;
    ctx.fillStyle = color;
    ctx.strokeStyle = stroke;
    ctx.lineWidth = fontSize / 15;
    ctx.textAlign = "center";

    const x = canvas.width / 2;
    const y = parseInt(box.style.top || (canvas.height - 50));

    ctx.strokeText(box.textContent, x, y);
    ctx.fillText(box.textContent, x, y);
}

document.getElementById("download").onclick = () => {
    if (!img.src) return alert("Upload an image first.");

    renderMeme();

    const link = document.createElement("a");
    link.download = "meme.png";
    link.href = canvas.toDataURL();
    link.click();
};
</script>
</body>
</html>
